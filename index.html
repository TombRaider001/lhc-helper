<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…­åˆå½©æ¨èå·¥å…·ï¼ˆæŠ“å–å¼€å¥–æ•°æ®ï¼‰</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f5f5f5; padding: 20px; }
    .card { box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .number-box {
      display: inline-block;
      width: 36px; height: 36px;
      line-height: 36px;
      text-align: center;
      background: #007bff;
      color: white;
      border-radius: 50%;
      margin: 2px;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4">ğŸ¯ å…­åˆå½©å¼€å¥– & æ¨èå·¥å…·</h2>

  <div class="card p-4 mb-4">
    <h5>ğŸ“Œ æœ€è¿‘ä¸€æœŸå¼€å¥–å·ç ï¼ˆæ¥è‡ª pilio ç½‘ç«™ï¼‰</h5>
    <button class="btn btn-primary btn-sm mb-3" onclick="loadPage()">ç‚¹å‡»è·å–</button>
    <div id="result" class="fs-5">ç­‰å¾…è·å–æ•°æ®...</div>
  </div>

  <div class="card p-4 mb-4">
    <h5>âœ¨ æ¨èå·ç </h5>
    <button class="btn btn-success btn-sm mb-2" onclick="recommend()">ç”Ÿæˆæ¨è</button>
    <div><strong>çƒ­å·æ¨èï¼š</strong><span id="hot"></span></div>
    <div><strong>å†·çƒ­æ··åˆï¼š</strong><span id="mix"></span></div>
    <div><strong>éšæœºæ¨èï¼š</strong><span id="rand"></span></div>
  </div>

  <div class="card p-4">
    <h5>ğŸ“– ç½‘ç«™è¯´æ˜</h5>
    <p>æœ¬é¡µé¢é€šè¿‡ä¸­è½¬ä»£ç†æŠ“å– <code>pilio.idv.tw</code> æä¾›çš„å…­åˆå½©å¼€å¥–é¡µé¢ï¼Œå¹¶è§£æå‡ºæœ€è¿‘ä¸€æœŸçš„æœŸå·ä¸å¼€å¥–å·ç ï¼Œå¹¶æä¾›æ¨èç»„åˆã€‚</p>
    <p>âš ï¸ æ•°æ®æ¥è‡ªå…¬å¼€ç½‘é¡µï¼Œä»…ä¾›å‚è€ƒã€‚</p>
  </div>
</div>

<script>
  let allNumbers = [];

  async function loadPage() {
    const output = document.getElementById('result');
    output.textContent = 'åŠ è½½ä¸­...';
    try {
      const proxy = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://www.pilio.idv.tw/ltohk/list.asp');
      const res = await fetch(proxy);
      const html = await res.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      const rows = doc.querySelectorAll("table tr");
      allNumbers = [];
      for (let i = 0; i < 100; i++) {
        const row = rows[i];
        if (!row || row.querySelectorAll(".tdStyle1").length < 2) continue;
        const tds = row.querySelectorAll(".tdStyle1");
        const nums = tds[1].textContent.trim().split(/\D+/).filter(n => n);
        if (nums.length >= 6) allNumbers.push(nums.map(n => parseInt(n)));
      }

      const latest = allNumbers[0];
      const issue = doc.querySelector(".tdStyle1").textContent.trim();
      output.innerHTML = `<strong>æœŸå·ï¼š</strong> ${issue} <br><strong>å¼€å¥–å·ç ï¼š</strong> ` +
        latest.map(n => `<span class="number-box">${n}</span>`).join('');
    } catch (e) {
      output.textContent = 'è·å–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
    }
  }

  function recommend() {
    if (allNumbers.length === 0) {
      alert("è¯·å…ˆè·å–å¼€å¥–æ•°æ®");
      return;
    }

    const freq = {};
    for (let i = 1; i <= 49; i++) freq[i] = 0;
    allNumbers.forEach(set => set.forEach(n => freq[n]++));

    const sorted = Object.entries(freq).sort((a,b) => b[1]-a[1]);
    const hot = sorted.slice(0,6).map(e=>parseInt(e[0]));
    const cold = sorted.slice(-6).map(e=>parseInt(e[0]));
    const mix = [...hot.slice(0,3), ...cold.slice(0,3)].sort((a,b)=>a-b);

    const rand = [];
    const pool = Array.from({length:49},(_,i)=>i+1);
    while(rand.length < 6) {
      const i = Math.floor(Math.random()*pool.length);
      rand.push(pool.splice(i,1)[0]);
    }

    document.getElementById("hot").innerHTML = hot.map(n => `<span class="number-box">${n}</span>`).join('');
    document.getElementById("mix").innerHTML = mix.map(n => `<span class="number-box">${n}</span>`).join('');
    document.getElementById("rand").innerHTML = rand.sort((a,b)=>a-b).map(n => `<span class="number-box">${n}</span>`).join('');
  }
</script>
</body>
</html>