<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å…­åˆå½©æ¨èå·¥å…·</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #f8f9fa; padding: 20px; }
    .number-box {
      display: inline-block;
      width: 40px; height: 40px;
      line-height: 40px;
      text-align: center;
      background: #007bff;
      color: white;
      border-radius: 50%;
      margin: 2px;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
<div class="container">

  <h1 class="mb-4">å…­åˆå½©å·ç æ¨èå·¥å…·</h1>

  <div class="mb-4">
    <h5>ğŸ¯ æœ€æ–°å¼€å¥–å·ç ï¼š</h5>
    <div id="latestInfo" class="mb-2">åŠ è½½ä¸­...</div>
    <div id="latestNums"></div>
  </div>

  <div class="mb-4">
    <h5>ğŸ“ˆ æ¨èå·ç ï¼š</h5>
    <div class="mb-2">
      <button class="btn btn-primary me-2" onclick="genAll()">ç”Ÿæˆæ¨è</button>
      <button class="btn btn-secondary me-2" onclick="refreshLatest()">åˆ·æ–°å¼€å¥–</button>
      <button class="btn btn-success" onclick="shareNumbers()">åˆ†äº«æ¨è</button>
    </div>
    <div class="mt-2"><strong>çƒ­å·ï¼š</strong><span id="hot"></span></div>
    <div class="mt-2"><strong>å†·çƒ­æ··åˆï¼š</strong><span id="mix"></span></div>
    <div class="mt-2"><strong>éšæœºæ¨èï¼š</strong><span id="random"></span></div>
  </div>

  <div class="mb-4">
    <h5>ğŸ“… å†å²æœŸå·é€‰æ‹©</h5>
    <select id="historySelect" class="form-select w-auto d-inline-block" onchange="onSelectHistory()"></select>
  </div>

  <div class="mb-4">
    <h5>ğŸ“Š çƒ­å·èµ°åŠ¿å›¾ï¼ˆæœ€è¿‘100æœŸï¼‰</h5>
    <canvas id="freqChart" height="200"></canvas>
  </div>

  <hr>

  <div class="mt-4">
    <h5>ğŸ§­ å½©ç¥¨è¯´æ˜</h5>
    <p>å…­åˆå½©ï¼ˆMark Sixï¼‰æ¯æœŸå¼€å¥– 6 ä¸ªå·ç  + 1 ä¸ªç‰¹åˆ«å·ç ï¼Œæ€»å·ç èŒƒå›´ 1â€“49ã€‚</p>
    <ul>
      <li>çƒ­å·ï¼šåœ¨æœ€è¿‘ 100 æœŸä¸­æœ€å¸¸å¼€çš„ 6 ä¸ªå·ç ã€‚</li>
      <li>å†·å·ï¼šæœ€è¿‘ 100 æœŸä¸­æœ€å°‘å¼€çš„ 6 ä¸ªå·ç ã€‚</li>
      <li>å†·çƒ­æ··åˆï¼šçƒ­å·å‰ä¸‰ + å†·å·å‰ä¸‰ç»„åˆã€‚</li>
      <li>éšæœºæ¨èï¼šç³»ç»Ÿéšæœºç”Ÿæˆ 6 ä¸ªå·ç ã€‚</li>
    </ul>
    <p>âš ï¸ æœ¬å·¥å…·ä»…ä¾›å‚è€ƒï¼Œå½©ç¥¨å±äºéšæœºé£é™©ï¼Œè¯·è°¨æ…å¯¹å¾…ã€‚</p>
  </div>

</div>

<script>
let historyData = [], historyIssues = [];

const proxy = url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

async function fetchLatest(){
  try {
    const res = await fetch(proxy('https://hk.marksixapi.com/latest'));
    const info = (await res.json()).data;
    document.getElementById('latestInfo').textContent = `ç¬¬ ${info.issue} æœŸ - ${info.time}`;
    document.getElementById('latestNums').innerHTML = info.nums.map(n => `<span class="number-box" onclick="copyNum(${n})">${n}</span>`).join('');
  } catch {
    document.getElementById('latestInfo').textContent = 'åŠ è½½å¤±è´¥';
  }
}

async function fetchHistory(){
  try {
    const res = await fetch(proxy('https://hk.marksixapi.com/history?limit=100'));
    const arr = (await res.json()).data;
    historyData = arr.map(e => e.nums.map(Number));
    historyIssues = arr.map(e => e.issue);
    initHistorySelector();
    drawChart();
  } catch {
    alert('å†å²æ•°æ®è·å–å¤±è´¥');
  }
}

function initHistorySelector(){
  const sel = document.getElementById('historySelect');
  sel.innerHTML = historyIssues.map((iss,i)=>`<option value="${i}">${historyIssues[i]}</option>`).join('');
}

function onSelectHistory(){
  const idx = document.getElementById('historySelect').value;
  const nums = historyData[idx];
  alert(`ç¬¬ ${historyIssues[idx]} æœŸ å†å²å¼€å¥–å·ç ï¼š${nums.join(' ')}`);
}

function calcFreq(){
  const freq = {};
  for(let i=1;i<=49;i++) freq[i]=0;
  historyData.forEach(arr=>arr.forEach(n=>freq[n]++));
  const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]);
  const hot = sorted.slice(0,6).map(e=>+e[0]), cold = sorted.slice(-6).map(e=>+e[0]);
  return {hot,cold,freq};
}

function genAll(){
  const {hot,cold} = calcFreq();
  document.getElementById('hot').innerHTML = hot.map(n=>`<span class="number-box" onclick="copyNum(${n})">${n}</span>`).join('');
  const mix = [...hot.slice(0,3),...cold.slice(0,3)].sort((a,b)=>a-b);
  document.getElementById('mix').innerHTML = mix.map(n=>`<span class="number-box" onclick="copyNum(${n})">${n}</span>`).join('');
  const pool = Array.from({length:49},(_,i)=>i+1);
  const rand=[];
  while(rand.length<6) rand.push(pool.splice(Math.floor(Math.random()*pool.length),1)[0]);
  document.getElementById('random').innerHTML = rand.sort((a,b)=>a-b).map(n=>`<span class="number-box" onclick="copyNum(${n})">${n}</span>`).join('');
}

function refreshLatest(){
  document.getElementById('latestInfo').textContent='åŠ è½½ä¸­...';
  document.getElementById('latestNums').innerHTML='';
  fetchLatest();
}

function shareNumbers(){
  const hot = document.getElementById('hot').textContent;
  const mix = document.getElementById('mix').textContent;
  const rand = document.getElementById('random').textContent;
  const text = `æ¨èå·ç \nçƒ­å·ï¼š${hot}\nå†·çƒ­æ··åˆï¼š${mix}\néšæœºæ¨èï¼š${rand}`;
  navigator.clipboard.writeText(text).then(() => alert('æ¨èå·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'));
}

function copyNum(n){
  navigator.clipboard.writeText(n).then(() => alert(`å·²å¤åˆ¶å·ç  ${n}`));
}

function drawChart(){
  const {freq} = calcFreq();
  new Chart(document.getElementById('freqChart'), {
    type:'bar',
    data:{
      labels: Object.keys(freq),
      datasets:[{label:'å‡ºç°æ¬¡æ•°',data:Object.values(freq),backgroundColor:'#007bff'}]
    },
    options:{scales:{y:{beginAtZero:true}},responsive:true}
  });
}

(async()=>{ await fetchHistory(); await fetchLatest(); })();
</script>
</body>
</html>